<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ResearchHub.App.ViewModels"
             xmlns:controls="using:ResearchHub.App.Controls"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="ResearchHub.App.Views.ScreeningView"
             x:DataType="vm:ScreeningViewModel">

    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto">
        <!-- Row 0: Progress Stats -->
        <Border Grid.Row="0" Padding="15" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Existing stats -->
                <Grid Grid.Column="0" ColumnDefinitions="*,*,*,*,*">
                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                        <TextBlock Text="Total" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding TotalCount}" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                        <TextBlock Text="Pending" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding PendingCount}" FontSize="24" FontWeight="Bold" Foreground="Orange" HorizontalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                        <TextBlock Text="Included" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding IncludedCount}" FontSize="24" FontWeight="Bold" Foreground="Green" HorizontalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                        <TextBlock Text="Excluded" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding ExcludedCount}" FontSize="24" FontWeight="Bold" Foreground="Red" HorizontalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                        <TextBlock Text="Maybe" FontSize="12" Foreground="Gray" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding MaybeCount}" FontSize="24" FontWeight="Bold" Foreground="Blue" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
                <!-- Screening mode buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8"
                            IsVisible="{Binding IsScreeningMode}">
                    <ToggleButton Content="PDF Panel (P)"
                                  IsChecked="{Binding IsPdfPanelVisible}"
                                  Padding="15,8" VerticalAlignment="Center"/>
                    <ToggleButton Content="Auto LLM"
                                  IsChecked="{Binding IsLlmAutoSuggestEnabled}"
                                  Padding="15,8" VerticalAlignment="Center"/>
                    <Button Content="Ask LLM (A)"
                            Command="{Binding RequestLlmSuggestionCommand}"
                            Padding="15,8" VerticalAlignment="Center"/>
                    <Button Content="Check Duplicates"
                            Command="{Binding CheckForDuplicatesCommand}"
                            Padding="15,8" VerticalAlignment="Center"/>
                    <ToggleButton Content="Dedup Settings"
                                  IsChecked="{Binding IsDedupSettingsVisible}"
                                  Padding="15,8" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Row 1: Progress Bar -->
        <!-- Screening progress -->
        <ProgressBar Grid.Row="1" Value="{Binding ProgressPercentage}" Maximum="100" Height="8"
                     IsVisible="{Binding IsScreeningMode}"/>
        <!-- Duplicate review progress -->
        <StackPanel Grid.Row="1" IsVisible="{Binding IsDuplicateReviewMode}">
            <ProgressBar Value="{Binding DuplicateProgressPercentage}" Maximum="100" Height="8"/>
            <TextBlock Text="{Binding DuplicateProgressText}" FontSize="11" Foreground="Gray"
                       HorizontalAlignment="Center" Margin="0,2,0,0"/>
        </StackPanel>

        <!-- Row 2: Dedup Settings (collapsible) -->
        <Border Grid.Row="2" Padding="12,8" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                IsVisible="{Binding IsDedupSettingsVisible}">
            <StackPanel Orientation="Horizontal" Spacing="24" HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="Year Tolerance:" VerticalAlignment="Center"/>
                    <NumericUpDown Value="{Binding DedupYearTolerance}" Minimum="0" Maximum="5"
                                   Increment="1" Width="100" FormatString="0"
                                   VerticalAlignment="Center"/>
                    <TextBlock Text="(0 = exact year match)" FontSize="11" Foreground="Gray"
                               VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="Spelling Normalization:" VerticalAlignment="Center"/>
                    <ToggleSwitch IsChecked="{Binding DedupNormalizeSpelling}"
                                  OnContent="On" OffContent="Off"
                                  VerticalAlignment="Center"/>
                    <TextBlock Text="(British/American variants)" FontSize="11" Foreground="Gray"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Row 3: Content Area -->
        <!-- Screening mode WITHOUT PDF panel -->
        <Border Grid.Row="3" Margin="20" Padding="30"
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                CornerRadius="8"
                IsVisible="{Binding IsScreeningWithoutPdf}">
            <Grid>
                <ScrollViewer IsVisible="{Binding CurrentReference, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <StackPanel Spacing="15">
                        <!-- Reference data -->
                        <StackPanel Spacing="15" DataContext="{Binding CurrentReference}">
                            <TextBlock Text="{Binding Title}" FontSize="18" FontWeight="Bold" TextWrapping="Wrap"/>
                            <TextBlock Text="{Binding Authors[0], StringFormat={}{0} et al.}"
                                       FontStyle="Italic" TextWrapping="Wrap" Foreground="Gray"/>
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="{Binding Journal}" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding Year, StringFormat='({0})'}"/>
                            </StackPanel>
                            <Separator Margin="0,10"/>
                            <TextBlock Text="Abstract" FontWeight="Bold" FontSize="14"/>
                            <TextBlock Text="{Binding Abstract, FallbackValue='No abstract available'}"
                                       TextWrapping="Wrap" LineHeight="24"/>
                            <StackPanel Orientation="Horizontal" Spacing="20" Margin="0,10,0,0">
                                <TextBlock Text="{Binding Doi, StringFormat='DOI: {0}'}"
                                           IsVisible="{Binding Doi, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                <TextBlock Text="{Binding Pmid, StringFormat='PMID: {0}'}"
                                           IsVisible="{Binding Pmid, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            </StackPanel>
                        </StackPanel>
                        <!-- AI Suggestion -->
                        <Border IsVisible="{Binding ShowLlmSection}"
                                Background="#1A3498DB" CornerRadius="6" Padding="15">
                            <StackPanel Spacing="8">
                                <TextBlock Text="AI Suggestion" FontWeight="Bold" FontSize="13" Foreground="#3498DB"/>
                                <!-- Loading state -->
                                <StackPanel IsVisible="{Binding IsLlmSuggestionLoading}" Spacing="6">
                                    <ProgressBar IsIndeterminate="True" Height="4"/>
                                    <TextBlock Text="Asking LLM..." FontSize="12" Foreground="Gray"/>
                                </StackPanel>
                                <!-- Result state -->
                                <StackPanel IsVisible="{Binding HasLlmSuggestion}" Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <TextBlock Text="{Binding LlmVerdictText}" FontWeight="Bold" FontSize="15"/>
                                        <TextBlock Text="{Binding LlmConfidenceText, StringFormat='Confidence: {0}'}"
                                                   IsVisible="{Binding LlmConfidenceText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                                   VerticalAlignment="Center" FontSize="13" Foreground="Gray"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding LlmReason}" TextWrapping="Wrap" FontSize="12"
                                               IsVisible="{Binding LlmReason, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                </StackPanel>
                                <!-- Error state -->
                                <TextBlock Text="{Binding LlmErrorMessage}" TextWrapping="Wrap"
                                           IsVisible="{Binding HasLlmError}"
                                           Foreground="#E67E22" FontSize="12"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                            IsVisible="{Binding CurrentReference, Converter={x:Static ObjectConverters.IsNull}}">
                    <TextBlock Text="Screening Complete!" FontSize="24" FontWeight="Bold"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="All references have been screened for this phase."
                               FontSize="14" Foreground="Gray" HorizontalAlignment="Center"/>
                    <Button Content="Proceed to Extraction"
                            Command="{Binding NavigateToExtractionCommand}"
                            HorizontalAlignment="Center" Margin="0,20,0,0"
                            Padding="25,12" FontWeight="SemiBold"
                            Background="#27AE60" Foreground="White"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Screening mode WITH PDF panel (split view) -->
        <Grid Grid.Row="3" ColumnDefinitions="2*,5,3*"
              IsVisible="{Binding IsScreeningWithPdf}">
            <!-- Left: Reference card -->
            <Border Grid.Column="0" Margin="10" Padding="20"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                    CornerRadius="8">
                <Grid>
                    <ScrollViewer IsVisible="{Binding CurrentReference, Converter={x:Static ObjectConverters.IsNotNull}}">
                        <StackPanel Spacing="12">
                            <!-- Reference data -->
                            <StackPanel Spacing="12" DataContext="{Binding CurrentReference}">
                                <TextBlock Text="{Binding Title}" FontSize="16" FontWeight="Bold" TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding Authors[0], StringFormat={}{0} et al.}"
                                           FontStyle="Italic" TextWrapping="Wrap" Foreground="Gray"/>
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="{Binding Journal}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Year, StringFormat='({0})'}"/>
                                </StackPanel>
                                <Separator Margin="0,8"/>
                                <TextBlock Text="Abstract" FontWeight="Bold" FontSize="13"/>
                                <TextBlock Text="{Binding Abstract, FallbackValue='No abstract available'}"
                                           TextWrapping="Wrap" LineHeight="22"/>
                                <StackPanel Orientation="Horizontal" Spacing="15" Margin="0,8,0,0">
                                    <TextBlock Text="{Binding Doi, StringFormat='DOI: {0}'}"
                                               IsVisible="{Binding Doi, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    <TextBlock Text="{Binding Pmid, StringFormat='PMID: {0}'}"
                                               IsVisible="{Binding Pmid, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                </StackPanel>
                            </StackPanel>
                            <!-- AI Suggestion -->
                            <Border IsVisible="{Binding ShowLlmSection}"
                                    Background="#1A3498DB" CornerRadius="6" Padding="12">
                                <StackPanel Spacing="6">
                                    <TextBlock Text="AI Suggestion" FontWeight="Bold" FontSize="12" Foreground="#3498DB"/>
                                    <!-- Loading state -->
                                    <StackPanel IsVisible="{Binding IsLlmSuggestionLoading}" Spacing="4">
                                        <ProgressBar IsIndeterminate="True" Height="4"/>
                                        <TextBlock Text="Asking LLM..." FontSize="11" Foreground="Gray"/>
                                    </StackPanel>
                                    <!-- Result state -->
                                    <StackPanel IsVisible="{Binding HasLlmSuggestion}" Spacing="4">
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <TextBlock Text="{Binding LlmVerdictText}" FontWeight="Bold" FontSize="14"/>
                                            <TextBlock Text="{Binding LlmConfidenceText, StringFormat='Confidence: {0}'}"
                                                       IsVisible="{Binding LlmConfidenceText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                                       VerticalAlignment="Center" FontSize="12" Foreground="Gray"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding LlmReason}" TextWrapping="Wrap" FontSize="11"
                                                   IsVisible="{Binding LlmReason, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </StackPanel>
                                    <!-- Error state -->
                                    <TextBlock Text="{Binding LlmErrorMessage}" TextWrapping="Wrap"
                                               IsVisible="{Binding HasLlmError}"
                                               Foreground="#E67E22" FontSize="11"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                IsVisible="{Binding CurrentReference, Converter={x:Static ObjectConverters.IsNull}}">
                        <TextBlock Text="Screening Complete!" FontSize="20" FontWeight="Bold"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="All references have been screened."
                                   FontSize="13" Foreground="Gray" HorizontalAlignment="Center"/>
                        <Button Content="Proceed to Extraction"
                                Command="{Binding NavigateToExtractionCommand}"
                                HorizontalAlignment="Center" Margin="0,15,0,0"
                                Padding="20,10" FontWeight="SemiBold"
                                Background="#27AE60" Foreground="White"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Center: Splitter -->
            <GridSplitter Grid.Column="1" Background="Gray" ResizeDirection="Columns"/>

            <!-- Right: PDF Viewer -->
            <Border Grid.Column="2" Margin="0,10,10,10" CornerRadius="8"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                <controls:PdfViewerControl FilePath="{Binding CurrentPdfPath}"/>
            </Border>
        </Grid>

        <!-- Duplicate review mode: side-by-side comparison -->
        <Border Grid.Row="3" Margin="10" Padding="10"
                IsVisible="{Binding IsDuplicateReviewMode}">
            <Grid>
                <!-- Active pair comparison -->
                <ScrollViewer IsVisible="{Binding CurrentDuplicatePair, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <StackPanel Spacing="10">
                        <!-- Warning banner -->
                        <Border Background="#FFF3CD" CornerRadius="6" Padding="12">
                            <TextBlock Text="{Binding DuplicateReasonSummary, StringFormat='Potential Duplicate: {0}'}"
                                       FontWeight="SemiBold" Foreground="#856404" TextWrapping="Wrap"/>
                        </Border>

                        <!-- Side-by-side cards -->
                        <Grid ColumnDefinitions="*,Auto,*">
                            <!-- Left card: Primary -->
                            <Border Grid.Column="0" BorderBrush="#27AE60" BorderThickness="2" CornerRadius="8"
                                    Padding="15" Margin="0,0,5,0"
                                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                                <StackPanel Spacing="8" DataContext="{Binding CurrentDuplicatePair.Primary}">
                                    <TextBlock Text="PRIMARY" FontSize="11" FontWeight="Bold" Foreground="#27AE60"/>
                                    <TextBlock Text="{Binding Title}" FontSize="14" FontWeight="Bold" TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding Authors[0], StringFormat={}{0} et al.}"
                                               FontStyle="Italic" Foreground="Gray" TextWrapping="Wrap"/>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="{Binding Journal}" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Text="{Binding Year, StringFormat='({0})'}" FontSize="12"/>
                                    </StackPanel>
                                    <Separator Margin="0,4"/>
                                    <TextBlock Text="{Binding Abstract, FallbackValue='No abstract available'}"
                                               TextWrapping="Wrap" FontSize="12" MaxLines="8"/>
                                    <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,4,0,0">
                                        <TextBlock Text="{Binding Doi, StringFormat='DOI: {0}'}" FontSize="11"
                                                   IsVisible="{Binding Doi, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                        <TextBlock Text="{Binding Pmid, StringFormat='PMID: {0}'}" FontSize="11"
                                                   IsVisible="{Binding Pmid, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding SourceFile, StringFormat='Source: {0}'}" FontSize="11" Foreground="Gray"
                                               IsVisible="{Binding SourceFile, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                </StackPanel>
                            </Border>

                            <!-- Center divider -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="8,0">
                                <TextBlock Text="VS" FontSize="18" FontWeight="Bold" Foreground="Gray"/>
                            </StackPanel>

                            <!-- Right card: Duplicate -->
                            <Border Grid.Column="2" BorderBrush="#3498DB" BorderThickness="2" CornerRadius="8"
                                    Padding="15" Margin="5,0,0,0"
                                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                                <StackPanel Spacing="8" DataContext="{Binding CurrentDuplicatePair.Duplicate}">
                                    <TextBlock Text="DUPLICATE" FontSize="11" FontWeight="Bold" Foreground="#3498DB"/>
                                    <TextBlock Text="{Binding Title}" FontSize="14" FontWeight="Bold" TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding Authors[0], StringFormat={}{0} et al.}"
                                               FontStyle="Italic" Foreground="Gray" TextWrapping="Wrap"/>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="{Binding Journal}" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Text="{Binding Year, StringFormat='({0})'}" FontSize="12"/>
                                    </StackPanel>
                                    <Separator Margin="0,4"/>
                                    <TextBlock Text="{Binding Abstract, FallbackValue='No abstract available'}"
                                               TextWrapping="Wrap" FontSize="12" MaxLines="8"/>
                                    <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,4,0,0">
                                        <TextBlock Text="{Binding Doi, StringFormat='DOI: {0}'}" FontSize="11"
                                                   IsVisible="{Binding Doi, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                        <TextBlock Text="{Binding Pmid, StringFormat='PMID: {0}'}" FontSize="11"
                                                   IsVisible="{Binding Pmid, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding SourceFile, StringFormat='Source: {0}'}" FontSize="11" Foreground="Gray"
                                               IsVisible="{Binding SourceFile, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>

                <!-- Completion message -->
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                            IsVisible="{Binding CurrentDuplicatePair, Converter={x:Static ObjectConverters.IsNull}}">
                    <TextBlock Text="Duplicate Review Complete!" FontSize="24" FontWeight="Bold"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Press Escape or click 'Back to Screening' to return."
                               FontSize="14" Foreground="Gray" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Row 4: Decision Buttons -->
        <!-- Screening mode buttons -->
        <Border Grid.Row="4" Padding="20" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                IsVisible="{Binding IsScreeningMode}">
            <Grid ColumnDefinitions="Auto,*,Auto,*,Auto">
                <ComboBox Grid.Column="0"
                          ItemsSource="{Binding CommonExclusionReasons}"
                          SelectedItem="{Binding ExclusionReason}"
                          PlaceholderText="Select exclusion reason (if excluding)"
                          Width="300" HorizontalAlignment="Left"/>
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="20"
                            HorizontalAlignment="Center">
                    <Button Content="Exclude (E)"
                            Command="{Binding ExcludeCommand}"
                            Background="#E74C3C" Foreground="White"
                            Padding="30,15" FontSize="16" FontWeight="Bold"/>
                    <Button Content="Maybe (M)"
                            Command="{Binding MaybeCommand}"
                            Background="#3498DB" Foreground="White"
                            Padding="30,15" FontSize="16" FontWeight="Bold"/>
                    <Button Content="Include (I)"
                            Command="{Binding IncludeCommand}"
                            Background="#27AE60" Foreground="White"
                            Padding="30,15" FontSize="16" FontWeight="Bold"/>
                </StackPanel>
                <StackPanel Grid.Column="4" VerticalAlignment="Center" HorizontalAlignment="Right" Spacing="4">
                    <Button Content="Attach PDF" Click="AttachPdfButton_Click" Padding="10,5"/>
                    <TextBlock Text="I=Include  E=Exclude  M=Maybe  P=PDF  A=Ask LLM"
                               FontSize="11" Foreground="Gray"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Duplicate review mode buttons -->
        <Border Grid.Row="4" Padding="20" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                IsVisible="{Binding IsDuplicateReviewMode}">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <Button Grid.Column="0" Content="Back to Screening"
                        Command="{Binding ExitDuplicateReviewCommand}"
                        Padding="15,10" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="20"
                            HorizontalAlignment="Center">
                    <Button Content="Keep Left (L)"
                            Command="{Binding KeepLeftCommand}"
                            Background="#27AE60" Foreground="White"
                            Padding="30,15" FontSize="16" FontWeight="Bold"/>
                    <Button Content="Skip (S)"
                            Command="{Binding SkipPairCommand}"
                            Padding="30,15" FontSize="16" FontWeight="Bold"/>
                    <Button Content="Keep Right (R)"
                            Command="{Binding KeepRightCommand}"
                            Background="#3498DB" Foreground="White"
                            Padding="30,15" FontSize="16" FontWeight="Bold"/>
                </StackPanel>
                <TextBlock Grid.Column="2" Text="Keyboard: L=Keep Left, R=Keep Right, S=Skip, Esc=Back"
                           FontSize="12" Foreground="Gray"
                           VerticalAlignment="Center" HorizontalAlignment="Right"/>
            </Grid>
        </Border>

        <!-- Loading Indicator (screening) -->
        <Border Grid.RowSpan="5" Background="#80000000"
                IsVisible="{Binding IsLoading}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200"/>
                <TextBlock Text="Loading..." Foreground="White" Margin="0,10"/>
            </StackPanel>
        </Border>

        <!-- Loading Indicator (duplicate check) -->
        <Border Grid.RowSpan="5" Background="#80000000"
                IsVisible="{Binding IsDuplicateCheckRunning}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200"/>
                <TextBlock Text="Scanning for duplicates..." Foreground="White" Margin="0,10"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
